Migrate:

rake redmine:load_default_data
rake db:migrate_plugins

Note:
ruby script/generate redmine_plugin <plugin_name>
ruby script/generate redmine_plugin_model <plugin_name> <model_name> [<fields>]
ruby script/generate redmine_plugin_controller <plugin_name> <controller_name> [<actions>]

Used Plugins:
will_paginate
paperclip

Used Gems:
environment.rb 增加

config.gem 'hpricot'
config.gem 'mechanize'

安装gem：
rake gems:install

= games

cocos2d-x.org/games/ 定制需求

1-GameList界面

1.1 games作为redmine插件能够被安装和卸载，并出现在redmine的administration->Plugins 列表仲

1.2 首个界面如图1所示，Add My Game!按钮显示在左上角醒目位置，对于已登陆用户，点击改按钮则进入到图2所表的AddMyGame界面，对于未登陆的用户，则首先跳转到 http://www.cocos2d-x.org/login 页要求用户登录

1.3 左边区域分Recommend和Last Updated两栏。游戏图标按照57x57的iphone标准图标大小，列数你自己觉得美观来摆放。Recommend是游戏提交后，我手动编辑勾选上的比较精品游戏，在这里显示2～4行，你按自己觉得美观来做。然后下面是Last Update,最后提交的游戏，按时间顺序排下去。Recommdn ＋ LastUpdate的总行数参考 cocos2d-iphone.org/games

1.4 每个游戏icon下面，显示游戏的名字太长摆不下，就末尾省略号...。游戏名下面显示游戏所属的平台，iOS, Android, WoPhone等。这些游戏平台需要可以让我在Administration->Plauins->Games-> Configure里修改、添加、重命名、删除、排序等

1.5 在该界面上点了more, 或者某个Platforms后，则维持右边的Platforms栏不变，左边取消Recommend, LastUpdated的分隔，显示该分类下的所有游戏，形式同样是icon + name + platform

1.6 每个游戏的platform枚举类型是一个字段，Recommend与否是另个bool字段，两个不同的属性。


2-Add My Game界面

2.1 用户登录redmine并且点击AddMyGame!按钮后进到该界面。添加游戏的过程分两步，界面类似，需要填写的内容不同

2.2 第一步是填写游戏的内容。这里面又再分两种情况。一种是iPhone/iPad等iOS应用, 用户只要输入一个Application ID就行了，剩余的工作我们网站去和AppStore抓取数据来同步；另一种情况是平台商城没有api可调用的情况，包括Android, WoPhone, Others，这种情况下就需要用户填写完整的游戏资料了。包括游戏名(title)，商城的网页链接(store url)，游戏icon, 截图，和描述。在iOS类和非iOS类，用radio button来切换，用户点了radio button之后，下面需要填写的表框也随之改变

2.3 对于icon，标明建议对方使用57x57分辨率的。如果提交的不是这个分辨率，则我们显示时做自动缩放

2.4 对于screenshots， 一开始就只显示三行，默认让用户传三张图片上来，如果用户有更多截图，则可以点Add more screenshots继续增加行数。最多限制个6行？或者你建议一下

2.5 对于上传的icon和screenshots文件，每个文件应限制一下大小，我不太清楚限制多少合适，您建议一下？ 限制大小的话也得在界面里说明一下。

2.6 红色＊号表示必填字段。点NEXT失败后，看怎么弹个警告框说哪个字段没填写，或者上传文件过大等具体错误情况



3-ContactInfo界面

3.1 实际上和前面是同个界面。用户在2-AddMyGame填写后点NEXT成功提交的话，进到这个界面

3.2 英文内容都照图上来，所有页面里的文字内容（不仅此页），最好都放到.yml格式的language文件里，后面我自己更新时方便修改文字内容，以及未来的多预言版本

3.3 注意这个界面里有张马克杯的图片。这个图片是为游戏提交者礼物发放的。以后可能会按更新出长袖T恤、短袖T恤等，因此比如叫gift.png的图片就放在插件目录里的指定位置，我要换礼物的时候直接同名替换这个图片文件即可。如果找不到这张图片的时候，就把img的位置隐藏掉，不要显示占位符

3.4 点FINISH后，看怎么样提示一下用户说提交成功，弄个简单的一页正中间显示几个大大的静态文本？还是既然没有设置审核，那么提交成功后就直接跳转到下一个4-GameDetail页面显示？


4-GameDetail

4.1 从1-GameList点击图标或游戏名的时候进到此页

4.2 当该页的访问用户，是游戏作者时，显示右上角的Edit, Delete; 是整个网站的Administrator时则显示Recommend. 如果管理员点了Recommend后，该游戏就会出现在1-GameList的Recommend列表里。

4.3 Author显示的是提交者的在redmine上注册的 名＋ 姓

4.4 点击Link to store会跳转到前面提交时填写的store url，或者根据Application ID抓下来的appstroe网址

4.5 底部的screenshots做法，参考 http://cocos2d-iphone.org/games/game/explosion-master/420194077 采用等比例缩小的图，当用户点击时，弹一张原始大小的大图出来。因为手机分辨率千差万别，尤其是android的。

5-GamesList

5.1 这个界面从Administration->Plugins->Configure点进去

5.2 界面类似projects->Settings->Forums的效果。左边是platform名字，中间有几个小按钮可以改变他们的排列顺序，右边可以点修改和删除。请参考附件中的settgins-forums.png。你用redmine随便建立个project，以管理员身份登录进去到project后点settings，然后forums就可以看到了。中间的绿色小箭头可以调整顺序的，直接复用这个功能就行。

5.4 这里没有给出New forum和Edit的界面，可以参考settings->forums的操作随便给个框让我填写platform名字就可以了。



＝ 补充
so sorry，昨晚才发现原来的需求有错。请按照新的这两张图纸设计。
Add my game里面，各平台成为复选关系，默认状态是全部选上，并且Applicaion ID及store url是加星的必填字段。用户可以把平台反选掉，反选之后，对应的Applicaion ID和store url输入框则disable掉不用输入，点next时也不判断。
然后，如果勾选了iphone或ipad其中之一，不论是否有勾选平台，则底下的icon, screenshots, description不用显示出来，detail直接从AppStore抓取；如果iphone/ipad两个都没选，而选了其他平台，则需要用户填写icon/screenshots/description
主要就改动了这个地方。

GameDetail页里则给出到各平台商城的的超链，这个地方改动比较小。


= 邮件
1. iphone和ipad的页面不同，application id也不同的。

比如你看这个cocos2d-x游戏，SuperPanda:
iphond版  http://itunes.apple.com/cn/app/super-panda/id409666382
ipad版  http://itunes.apple.com/cn/app/super-panda-hd/id411438201
两个应用不同、图标不同（一个有hd标志）、下载包的大小不同，id不同.

然后，植物大战僵尸
iphone版本 http://itunes.apple.com/cn/app/plants-vs-zombies/id350642635?mt=8  售价2.99美元
ipad版本     http://itunes.apple.com/cn/app/plants-vs-zombies-hd/id363282253?mt=8  售价6.99美元

严格说来，android market上，同个游戏也会分手机版本和平板电脑用的HD版本。同样上面那个SuperPanda
手机版 https://market.android.com/details?id=com.vicono.SuperPanda
HD版 https://market.android.com/details?id=com.vicono.SuperPandaHD

看这个需求怎么设计一下，用户开发出了HD版本，肯定会想把链接也挂上来的

2. 采用填写applicaion id的方式，我考虑的是，url是按游戏发布的国家来的。比如他这个游戏做了个多语言版本，那么
中国区 http://itunes.apple.com/cn/app/id406465247
美国区 http://itunes.apple.com/us/app/id406465247
日本区 http://itunes.apple.com/jp/app/id406465247
注意看，里面的cn，us，jp不一样。那么页面里抓取的内容也不一样了。如果这个地方让用户自己填url,那么中国的开发者就习惯性填中国区的，日本的开发者就习惯性填日本区的，这样整个网站就没法看了。
所以其实让开发者填写id后，你可以按照itunes的命名规则自己填充出来url地址的。比如上面这个三国塔防游戏，id = 406465247，那么我们奔着抓取英文内容的目标，就填充为http://itunes.apple.com/us/app/id406465247, 这样抓下来的内容就大家都能看懂了。
但这样的缺点是，如果那个游戏就是那么拽，不发美国版呢？那么我们自动补齐的方式就傻掉了。我不太清楚cocos2d-iphone.org/games里面是怎么做的。

那么回头说，如果让用户填写url也是可以的，因为你可以url string中分析出id来，然后根据id自动补齐找到美国区。这样反倒有个好处，就是一旦在美国区里找不到数据，那么就可以退回来拿用户填写的url去抓。您看这个策略如何？


＝ 邮件
真高兴看到基本框架已经都完成了。我最后用 http://bitnami.org/stacks装了 RubyStack + redmine module, 轻松配置在mac下搭好了环境。跑了下你最后发给我的包，有以下bug：

- 1. Add My Game的时候，title, icon等必填字段没有填写时，仍然可以进到下一页
- 2. Add My Game页里，即使在英文版里仍然显示“下一步”。另，而且这个“下一步”的位置和大小不太显眼，能否用ContactInfo页的Create这样的按钮。
- 3. 按照需求文档，在Contact Info页，Title行应该隐藏了。这页里完全是作者信息，与游戏无关了
- 4. Send me the mug for free! 下面是否有留出一个礼物图片的位置呢？你先随便放个图片在那儿
- 5. 不要默认写入用户名到Author Name行。因为网站上的用户名一般是昵称，寄礼物过去要真实名字才能收到快递。这里默认填个昵称，容易让人误解。而且当昵称为abc，我add时添加def后提交成功后，再点edit时仍然显示出来abc
- 6. 显示icon的地方，会在左上角显示个Mask120, Mask57的字样，可能是你debug用的吧？
? 7. Edit页编辑完后点save时出错 ActiveRecord::RecordNotFound in AppsController#update
- 8. 在game list页里，插件的名字太短，只显示了两个字母. 其实两个游戏icon之间可以排得开一些，一般游戏名字怎么也得有个15～20个英文字母吧
- 9. 可以商榷的需求细节：插件页面的url。参考embedded插件，它显示为 http://www.cocos2d-x.org/embedded/cocos2d-x，所以格式是 http://www.webstie.com/plugin/project  我们现在的格式是 http://127.0.0.1:3000/apps/show/1?project_id=cocos2d-x能否改成 http://www.cocos2d-x.org/games/cocos2d-x/... 这样？因为现在如果不分的话，下一个插件也这样搞可能那么就乱掉了。

- 10. GameList页，右边的Platforms列表，每个platform后面括号一下，标注各平台游戏的当前总数，比如
  iPhone (123)
  iPad (234)
  这个需求文档里有。

? 11. 我想加个需求功能，就是有新增游戏，或者已有游戏编辑修改后，能否自动发封邮件给网站的administrator呢？不然有人往里头加垃圾信息我都不知道

- 12. 使用表前缀 games_


您可以到 http://www.cocos2d-x.org/projects/test/apps看下部署的情况。帐号密码都是liwei

- 1. GameList页， Recommend和LastUpdated的上下距离拉得太开。两者之间可以容纳两行图标的距离就行了

? 2. 图标Mask能否加个if判断，只对iOS游戏起效果。因为android平台，wophone平台的图标都不是这种圆角矩形的。Android是方形图标，wophone是u型图标

- 3. 由于Detail页中是一定会显示Author Name的, 所以这个地方就显示为提交者的论坛id好了, 并可以链接到redmine的用户页上，如 http://www.cocos2d-x.org/users/233

- 4. 在两个提交页里，Next, Prev, Save的摆放位置，你原先的设计是对的，遵照了redmine多数页面的习惯。我错了，sorry，能否把这三个链接再调整到整个信息框的左下角

- 5. 遇到中文全部是???问号。
  (1) 提交的screenshot或icon文件名里包含中文时，则提交后在GameList页和Detail页无法显示出图片;
  (2) Description输入中文时，显示一堆问号，如http://www.cocos2d-x.org/projects/test/apps/5  我们虽然建议用英文，但不能阻止开发者提交各国语言的内容，然后让读者用google translate翻译了看
  (3) 如果抓取的application id是对应中文内容，比如新浪微博HD id=386098453, 则Desctription一堆问号，screenshot也没抓下来。

- 6. 关于platform和AutoSync, 我终于想出个比较好的设计了。
  (1) 总体思路就是让作者把为手机做的MyGame和为平板电脑做的MyGame-HD分开为两个游戏提交到这个系统里。这样一切就都简单了。我们的别扭之处就在于，AppStore和android market都上都把iphone和ipad区分为两个应用，我们却硬要合为一个，别扭在这儿。
  (2) 首先，合并iPhone和iPad两个平台，统称为iOS
  (3) 在About My Game页，拆分成3步：第一步填写ApplicationID或store url, 第二步确认抓取的信息，弱无抓取则填写Detail, 第三步填写ContactInfo。所以，第一步，填写iOS, Android, WoPhone, Bada, Other等5个输入框，左边不放复选框了. 点next后，直接判断这几个框里是否有输入。如果iOS栏有输入，则去抓取数据，并把数据显示在第2步，类似现在edit是显示已有内容的效果。如果iOS栏没有输入，则在第2步显示Manual Input的那些东西。第三步照旧填ContactInfo
  (4) 在edit的时候，也仍然是这三步，在第一页点next时，只要有填写iOS的数据，就去默认去抓数据过来同步

- 7. 添加游戏时，自动邮件通知里的url链接地址有错, 你把域名用text.com了，后面的project也仍然用了编号

- 8. 页面右侧的Platforms列表，All(123), iPhond(12), iPad(34), 这些除了All, 其他链接点进去都是403错误

- 9. 如果游戏在提交时auto sync成功，那么在edit时，又Auto sync一次，则旧的截图没有删掉，新抓过来截图继续加在后面，会重复。见http://www.cocos2d-x.org/projects/test/apps/1底下的截图。每次sync后是否把旧的图片删除掉呢？因为appstore上的同个游戏是会不断更新发新版本的。

- 10. 在提交游戏的最后一步，如果qq没填的话，就直接跳回第一步了，而不是停留在填写Contact Info的这步。

- 11. GameList页里，游戏名的显示字数仍然太少，多数游戏名字都显示不全而依赖...省略号。或者您直接告诉我这个应该在代码什么位置调整这个参数

- 12. 最后，比较郁闷的一个地方，用户填写了他的网络联系方式、快递地址等，我却没有界面可以查看这些信息。能否在什么地方加一下让管理员看到这些信息呢？比如administrator进去的configure页，或者在detail页里判断出管理员权限后就把隐私信息附在后面？
